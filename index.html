<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X/Twitter Media Downloader</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #1DA1F2;
            --dark-blue: #0d8bd9;
            --light-blue: #e8f5fe;
        }

        body {
            background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 20px 0;
        }

        .main-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white;
            padding: 40px 0;
            margin-bottom: 40px;
            box-shadow: 0 4px 15px rgba(29, 161, 242, 0.3);
        }

        .main-header h1 {
            font-weight: 700;
            margin-bottom: 10px;
        }

        .main-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .download-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--light-blue);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .download-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(29, 161, 242, 0.2);
        }

        .card-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            margin: 0 auto 20px;
        }

        .section-title {
            color: var(--primary-blue);
            font-weight: 600;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-control {
            border: 2px solid var(--light-blue);
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 0.2rem rgba(29, 161, 242, 0.25);
        }

        .btn-download {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(29, 161, 242, 0.3);
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(29, 161, 242, 0.4);
            color: white;
        }

        .btn-download:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .preview-container {
            margin-top: 30px;
            padding: 20px;
            background: var(--light-blue);
            border-radius: 10px;
            display: none;
        }

        .preview-container img,
        .preview-container video {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .alert {
            border-radius: 10px;
            border: none;
        }

        .spinner-border {
            width: 20px;
            height: 20px;
            border-width: 2px;
        }

        .footer {
            text-align: center;
            padding: 20px 0;
            color: var(--primary-blue);
            margin-top: 40px;
        }

        .instructions {
            background: var(--light-blue);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .instructions h5 {
            color: var(--primary-blue);
            font-weight: 600;
        }

        .instructions ul {
            margin-bottom: 0;
        }

        .media-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>
    <div class="main-header">
        <div class="container">
            <div class="text-center">
                <h1><i class="fab fa-twitter"></i> X/Twitter Media Downloader</h1>
                <p>Download images and videos from X (Twitter) easily</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="instructions">
            <h5><i class="fas fa-info-circle"></i> How to Use:</h5>
            <ul>
                <li>Copy the URL of an X post containing an image or video</li>
                <li>Paste it in the appropriate section below</li>
                <li>Click the download button to view and save the media</li>
            </ul>
        </div>

        <div class="row">
            <!-- Image Download Section -->
            <div class="col-md-6">
                <div class="download-card">
                    <div class="card-icon">
                        <i class="fas fa-image"></i>
                    </div>
                    <h3 class="section-title text-center">Download Image</h3>
                    
                    <div class="mb-3">
                        <label for="imageUrl" class="form-label">X URL</label>
                        <input type="text" class="form-control" id="imageUrl" 
                               placeholder="https://x.com/username/status/...">
                    </div>
                    
                    <button class="btn btn-download w-100" id="downloadImageBtn">
                        <i class="fas fa-download"></i> Download Image
                    </button>

                    <div id="imageAlert"></div>
                    <div id="imagePreview" class="preview-container"></div>
                </div>
            </div>

            <!-- Video Download Section -->
            <div class="col-md-6">
                <div class="download-card">
                    <div class="card-icon">
                        <i class="fas fa-video"></i>
                    </div>
                    <h3 class="section-title text-center">Download Video</h3>
                    
                    <div class="mb-3">
                        <label for="videoUrl" class="form-label">X URL</label>
                        <input type="text" class="form-control" id="videoUrl" 
                               placeholder="https://x.com/username/status/...">
                    </div>
                    
                    <button class="btn btn-download w-100" id="downloadVideoBtn">
                        <i class="fas fa-download"></i> Download Video
                    </button>

                    <div id="videoAlert"></div>
                    <div id="videoPreview" class="preview-container"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p><i class="fas fa-heart" style="color: #e74c3c;"></i> Made for easy media downloads</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Utility function to show alerts
        function showAlert(elementId, message, type = 'danger') {
            const alertDiv = document.getElementById(elementId);
            alertDiv.innerHTML = `
                <div class="alert alert-${type} mt-3" role="alert">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
                    ${message}
                </div>
            `;
        }

        // Extract tweet ID from URL
        function extractTweetId(url) {
            const match = url.match(/status\/(\d+)/);
            return match ? match[1] : null;
        }

        // Function to actually download the file
        async function downloadImage(imageUrl, filename) {
            try {
                // Show loading state
                const statusDiv = document.createElement('div');
                statusDiv.className = 'alert alert-info mt-2';
                statusDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Downloading...';
                event.target.parentElement.appendChild(statusDiv);

                // Fetch the image
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                
                // Create download link
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = filename;
                
                // Trigger download
                document.body.appendChild(a);
                a.click();
                
                // Cleanup
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                // Remove loading state and show success
                statusDiv.className = 'alert alert-success mt-2';
                statusDiv.innerHTML = '<i class="fas fa-check-circle"></i> Downloaded successfully!';
                setTimeout(() => statusDiv.remove(), 3000);
            } catch (error) {
                console.error('Download error:', error);
                alert('Download failed. Please right-click the image and select "Save image as..."');
            }
        }

        // Function to fetch with multiple CORS proxies as fallback
        async function fetchWithProxy(url) {
            const proxies = [
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(url)}`
            ];

            for (let proxy of proxies) {
                try {
                    const response = await fetch(proxy);
                    if (response.ok) {
                        return await response.json();
                    }
                } catch (error) {
                    console.log(`Proxy ${proxy} failed, trying next...`);
                    continue;
                }
            }
            throw new Error('All proxies failed');
        }

        // Download Image
        document.getElementById('downloadImageBtn').addEventListener('click', async function() {
            const url = document.getElementById('imageUrl').value.trim();
            const btn = this;
            const previewDiv = document.getElementById('imagePreview');
            const alertDiv = document.getElementById('imageAlert');
            
            if (!url) {
                showAlert('imageAlert', 'Please enter a valid X post URL');
                return;
            }

            const tweetId = extractTweetId(url);
            if (!tweetId) {
                showAlert('imageAlert', 'Invalid X post URL format. URL should contain /status/[numbers]');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';
            previewDiv.style.display = 'none';
            alertDiv.innerHTML = '';

            try {
                // Try using the syndication API
                const apiUrl = `https://cdn.syndication.twimg.com/tweet-result?id=${tweetId}&lang=en&token=a`;
                
                let data;
                try {
                    data = await fetchWithProxy(apiUrl);
                } catch (proxyError) {
                    // Fallback: construct image URLs directly from tweet ID
                    // This is a workaround when APIs fail
                    const fallbackImages = [
                        `https://pbs.twimg.com/media/${tweetId}?format=jpg&name=large`,
                        `https://pbs.twimg.com/media/${tweetId}?format=png&name=large`
                    ];
                    
                    previewDiv.innerHTML = `
                        <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                            <i class="fas fa-info-circle"></i> Manual Download
                        </h5>
                        <div class="alert alert-info">
                            <p><strong>To download images from this post:</strong></p>
                            <ol>
                                <li>Open the X post in your browser</li>
                                <li>Right-click on the image</li>
                                <li>Select "Save image as..." or "Open image in new tab"</li>
                                <li>Then right-click and save</li>
                            </ol>
                        </div>
                        <a href="${url}" target="_blank" class="btn btn-download w-100">
                            <i class="fas fa-external-link-alt"></i> Open X Post
                        </a>
                    `;
                    previewDiv.style.display = 'block';
                    showAlert('imageAlert', 'Unable to fetch automatically. Please use manual download method above.', 'warning');
                    return;
                }
                
                // Check for images in the response
                if (data.photos && data.photos.length > 0) {
                    let imagesHtml = '';
                    
                    data.photos.forEach((photo, index) => {
                        const imageUrl = photo.url.replace(/&name=\w+/, '&name=orig');
                        const filename = `x-image-${tweetId}-${index + 1}.jpg`;
                        
                        imagesHtml += `
                            <div class="media-item">
                                <img src="${imageUrl}" alt="X Image ${index + 1}" class="img-fluid rounded mb-3" crossorigin="anonymous">
                                <button class="btn btn-download w-100" onclick="downloadImage('${imageUrl}', '${filename}')">
                                    <i class="fas fa-download"></i> Download Image ${data.photos.length > 1 ? (index + 1) : ''}
                                </button>
                            </div>
                        `;
                    });
                    
                    previewDiv.innerHTML = `
                        <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                            <i class="fas fa-images"></i> Found ${data.photos.length} Image(s)
                        </h5>
                        ${imagesHtml}
                    `;
                    previewDiv.style.display = 'block';
                    showAlert('imageAlert', `Successfully loaded ${data.photos.length} image(s)! Click download buttons to save.`, 'success');
                } else {
                    showAlert('imageAlert', 'No images found in this X post.');
                }
            } catch (error) {
                console.error('Error:', error);
                
                // Show manual download instructions
                previewDiv.innerHTML = `
                    <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                        <i class="fas fa-info-circle"></i> Manual Download Instructions
                    </h5>
                    <div class="alert alert-info">
                        <p><strong>To download images from this post:</strong></p>
                        <ol>
                            <li>Click the button below to open the X post</li>
                            <li>Right-click on the image(s) you want</li>
                            <li>Select "Save image as..." from the menu</li>
                            <li>Choose where to save and click Save</li>
                        </ol>
                    </div>
                    <a href="${url}" target="_blank" class="btn btn-download w-100">
                        <i class="fas fa-external-link-alt"></i> Open X Post
                    </a>
                `;
                previewDiv.style.display = 'block';
                showAlert('imageAlert', 'Please use the manual download method above.', 'warning');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-download"></i> Download Image';
            }
        });

        // Download Video
        document.getElementById('downloadVideoBtn').addEventListener('click', async function() {
            const url = document.getElementById('videoUrl').value.trim();
            const btn = this;
            const previewDiv = document.getElementById('videoPreview');
            const alertDiv = document.getElementById('videoAlert');
            
            if (!url) {
                showAlert('videoAlert', 'Please enter a valid X post URL');
                return;
            }

            const tweetId = extractTweetId(url);
            if (!tweetId) {
                showAlert('videoAlert', 'Invalid X post URL format. URL should contain /status/[numbers]');
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Loading...';
            previewDiv.style.display = 'none';
            alertDiv.innerHTML = '';

            try {
                const apiUrl = `https://cdn.syndication.twimg.com/tweet-result?id=${tweetId}&lang=en&token=a`;
                
                let data;
                try {
                    data = await fetchWithProxy(apiUrl);
                } catch (proxyError) {
                    // Fallback to manual instructions
                    previewDiv.innerHTML = `
                        <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                            <i class="fas fa-info-circle"></i> Manual Download
                        </h5>
                        <div class="alert alert-info">
                            <p><strong>To download videos from this post:</strong></p>
                            <ol>
                                <li>Click the button below to open a video downloader site</li>
                                <li>The URL will be pre-filled</li>
                                <li>Click the download button on that site</li>
                                <li>Choose your preferred quality and download</li>
                            </ol>
                        </div>
                        <a href="https://twdown.net/download.php?URL=${encodeURIComponent(url)}" target="_blank" class="btn btn-download w-100 mb-2">
                            <i class="fas fa-external-link-alt"></i> Download via TWDown
                        </a>
                        <a href="https://ssstwitter.com" target="_blank" class="btn btn-download w-100">
                            <i class="fas fa-external-link-alt"></i> Download via SSSTwitter
                        </a>
                    `;
                    previewDiv.style.display = 'block';
                    showAlert('videoAlert', 'Please use one of the download services above.', 'warning');
                    return;
                }
                
                if (data.video && data.video.variants) {
                    const variants = data.video.variants;
                    const mp4Videos = variants
                        .filter(v => v.type === 'video/mp4')
                        .sort((a, b) => (b.bitrate || 0) - (a.bitrate || 0));
                    
                    if (mp4Videos.length > 0) {
                        const bestVideo = mp4Videos[0];
                        const videoUrl = bestVideo.src;
                        
                        let videoOptionsHtml = '';
                        mp4Videos.forEach((video, index) => {
                            const quality = video.bitrate 
                                ? `${Math.round(video.bitrate / 1000)}kbps` 
                                : 'Standard';
                            const qualityLabel = index === 0 ? 'HD (Best Quality)' : quality;
                            const filename = `x-video-${tweetId}-${quality}.mp4`;
                            
                            videoOptionsHtml += `
                                <a href="${video.src}" download="${filename}" target="_blank" class="btn btn-download w-100 mb-2">
                                    <i class="fas fa-download"></i> Download ${qualityLabel}
                                </a>
                            `;
                        });
                        
                        previewDiv.innerHTML = `
                            <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                                <i class="fas fa-video"></i> Video Preview
                            </h5>
                            <div class="media-item">
                                <video controls class="img-fluid rounded mb-3">
                                    <source src="${videoUrl}" type="video/mp4">
                                    Your browser does not support the video tag.
                                </video>
                            </div>
                            <div class="alert alert-info mb-3">
                                <i class="fas fa-info-circle"></i> Choose your preferred quality:
                            </div>
                            ${videoOptionsHtml}
                        `;
                        previewDiv.style.display = 'block';
                        showAlert('videoAlert', 'Video loaded successfully!', 'success');
                    } else {
                        showAlert('videoAlert', 'Video format not supported.');
                    }
                } else {
                    showAlert('videoAlert', 'No video found in this X post.');
                }
            } catch (error) {
                console.error('Error:', error);
                
                previewDiv.innerHTML = `
                    <h5 class="text-center mb-4" style="color: var(--primary-blue);">
                        <i class="fas fa-info-circle"></i> Alternative Download Methods
                    </h5>
                    <div class="alert alert-info">
                        <p><strong>Use these trusted services to download the video:</strong></p>
                    </div>
                    <a href="https://twdown.net/download.php?URL=${encodeURIComponent(url)}" target="_blank" class="btn btn-download w-100 mb-2">
                        <i class="fas fa-external-link-alt"></i> Download via TWDown
                    </a>
                    <a href="https://ssstwitter.com" target="_blank" class="btn btn-download w-100">
                        <i class="fas fa-external-link-alt"></i> Download via SSSTwitter
                    </a>
                `;
                previewDiv.style.display = 'block';
                showAlert('videoAlert', 'Please use one of the services above.', 'warning');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-download"></i> Download Video';
            }
        });

        // Make downloadImage function available globally
        window.downloadImage = downloadImage;
    </script>
</body>
</html>